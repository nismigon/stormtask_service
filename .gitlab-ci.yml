stages:
  - lint
  - test

server-go-lint:
  stage: lint
  image: docker
  services:
  - docker:dind
  script:
    - cd server
    - docker build -t stormtask_image_lint -f Dockerfile.lint .
    - docker run stormtask_image_lint -d
    - docker wait stormtask_image_lint

server-go-test:
  stage: test
  image: docker/compose:latest
  services:
  - docker:dind
  script:
  - docker-compose -f docker/compose_test.yaml -p stormtask_compose_test up -d
  - docker wait stormtask_image_test
